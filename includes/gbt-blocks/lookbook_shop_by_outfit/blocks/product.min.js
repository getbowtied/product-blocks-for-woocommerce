"use strict";!function(blocks,components,blockEditor,i18n,element){var el=window.wp.element.createElement,registerBlockType=blocks.registerBlockType,TextControl=components.TextControl,SelectControl=components.SelectControl,Button=(components.RangeControl,components.Button),SVG=components.SVG,Path=components.Path,_wp$blockEditor=wp.blockEditor,InspectorControls=_wp$blockEditor.InspectorControls,MediaUpload=_wp$blockEditor.MediaUpload,apiFetch=wp.apiFetch,useEffect=wp.element.useEffect;registerBlockType("getbowtied/lookbook-shop-by-outfit-product",{title:i18n.__("Lookbook - Shop by Outfit Product"),icon:el(SVG,{key:"getbowtied-lookbook-sbo-product-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},el(Path,{d:"M21 4H3c-1.1 0-2 .9-2 2v13c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zM3 19V6h8v13H3zm18 0h-8V6h8v13zm-7-9.5h6V11h-6zm0 2.5h6v1.5h-6zm0 2.5h6V16h-6z"})),category:"product_blocks",parent:["getbowtied/lookbook-shop-by-outfit"],supports:{align:["full"]},attributes:{productIDs:{type:"string",default:""},image_position:{type:"string",default:"image-right"},imgURL:{type:"string",attribute:"src",default:""},imgID:{type:"number",default:0},imgAlt:{type:"string",attribute:"alt"},queryProducts:{type:"string",default:""},queryProductsLast:{type:"string",default:""},queryDisplayType:{type:"string",default:"default"},isLoading:{type:"boolean",default:!1},selectedIDS:{type:"string",default:""},querySearchString:{type:"string",default:""},querySearchResults:{type:"array",default:[]},querySearchNoResults:{type:"boolean",default:!1},querySearchSelected:{type:"array",default:[]},old_align:{type:"string",default:""},selectedSlide:{type:"integer",default:0},align:{type:"string",default:"full"}},edit:function(props){function toArray(s){var ret=[];0<s.length&&(ret=s.split(","));for(var i=0;i<ret.length;i++)""==ret[i]?ret.splice(i,1):ret[i]=Number(ret[i]);return ret}function _searchDisabledClass(){return 5<attributes.querySearchSelected.length||5<toArray(attributes.selectedIDS).length?"is-disabled":""}function getQuery(query){return"/wc/v2/products"+query}function getProducts(query){null===query&&(query=attributes.queryProducts,useEffect(function(){props.setAttributes({queryProductsLast:query})})),""!=query&&apiFetch({path:query}).then(function(products){props.setAttributes({result:products}),props.setAttributes({isLoading:!1}),!1===attributes.doneFirstLoad&&props.setAttributes({querySearchSelected:products}),props.setAttributes({doneFirstLoad:!0});for(var IDs="",i=0;i<products.length;i++)IDs+=products[i].id+",";props.setAttributes({productIDs:IDs}),props.setAttributes({selectedSlide:0})})}var attributes=props.attributes;attributes.result=attributes.result||[],attributes.isLoading=attributes.isLoading||!1,attributes.querySearchString=attributes.querySearchString||"",attributes.querySearchResults=attributes.querySearchResults||[],attributes.querySearchNoResults=attributes.querySearchNoResults||!1,attributes.doneFirstLoad=attributes.doneFirstLoad||!1,"full"!=attributes.align&&useEffect(function(){props.setAttributes({align:"full"})});return[el(InspectorControls,{key:"lookbook-shop-by-outfit-product-inspector"},el("div",{className:"products-main-inspector-wrapper"},el("div",{className:"products-ajax-search-wrapper "+_searchDisabledClass()},el(TextControl,{key:"query-panel-string",type:"search",className:"products-ajax-search",value:attributes.querySearchString,placeholder:i18n.__("Search for products to display"),disabled:5<attributes.querySearchSelected.length,onChange:function(newQuery){if(props.setAttributes({querySearchString:newQuery}),!(newQuery.length<3)){var query=getQuery("?per_page=10&search="+newQuery);apiFetch({path:query}).then(function(products){0==products.length?props.setAttributes({querySearchNoResults:!0}):props.setAttributes({querySearchNoResults:!1}),props.setAttributes({querySearchResults:products})})}}})),0<attributes.querySearchResults.length&&""!=attributes.querySearchString&&el("div",{className:"products-ajax-search-results"},function(){var productElements=[];if(!0===attributes.querySearchNoResults)return el("span",{key:"gbt-sbo-product-no-results",className:"no-results"},i18n.__("No products matching."));for(var theID,products=attributes.querySearchResults,i=0;i<products.length;i++){var img="";img=void 0!==products[i].images[0].src&&""!=products[i].images[0].src?el("span",{key:"gbt-sbo-product-img-wrapper",className:"img-wrapper",dangerouslySetInnerHTML:{__html:'<span class="img" style="background-image: url(\''+products[i].images[0].src+"')\"></span>"}}):el("span",{key:"gbt-sbo-product-img-wrapper",className:"img-wrapper",dangerouslySetInnerHTML:{__html:'<span class="img" style="background-image: url(\''+getbowtied_pbw.woo_placeholder_image+"')\"></span>"}}),productElements.push(el("span",{key:"gbt-sbo-product-search-result-item-"+i,className:(theID=products[i].id,(-1==toArray(attributes.selectedIDS).indexOf(theID)?"single-result":"single-result selected")+" "+_searchDisabledClass()),title:products[i].name,"data-index":i},img,el("label",{key:"gbt-sbo-product-search-result-item-label-"+i,className:"title-wrapper"},el("input",{key:"gbt-sbo-product-search-result-item-input-"+i,type:"checkbox",value:i,onChange:function(evt){if(!(5<toArray(attributes.selectedIDS).length)){evt.target;var qSR=toArray(attributes.selectedIDS),index=qSR.indexOf(products[evt.target.value].id);-1==index?qSR.push(products[evt.target.value].id):qSR.splice(index,1),props.setAttributes({selectedIDS:qSR.join(",")});var query=getQuery("?include="+qSR.join(",")+"&orderby=include");0<qSR.length?props.setAttributes({queryProducts:query}):props.setAttributes({queryProducts:""}),apiFetch({path:query}).then(function(products){props.setAttributes({querySearchSelected:products})})}}}),products[i].name,el("span",{key:"gbt-sbo-product-search-result-item-dashicon-yes-"+i,className:"dashicons dashicons-yes"}),el("span",{key:"gbt-sbo-product-search-result-item-dashicon-noalt-"+i,className:"dashicons dashicons-no-alt"}))))}return productElements}()),0<attributes.querySearchSelected.length&&el("div",{className:"products-selected-results-wrapper"},el("label",{},i18n.__("Selected Products:")),el("div",{className:"products-selected-results"},function(){for(var productElements=[],products=attributes.querySearchSelected,i=0;i<products.length;i++){var img="";img=void 0!==products[i].images[0].src&&""!=products[i].images[0].src?el("span",{key:"gbt-sbo-product-search-result-img-wrapper",className:"img-wrapper",dangerouslySetInnerHTML:{__html:'<span class="img" style="background-image: url(\''+products[i].images[0].src+"')\"></span>"}}):el("span",{key:"gbt-sbo-product-search-result-img-wrapper",className:"img-wrapper",dangerouslySetInnerHTML:{__html:'<span class="img" style="background-image: url(\''+getbowtied_pbw.woo_placeholder_image+"')\"></span>"}}),productElements.push(el("span",{key:"gbt-sbo-product-search-result-item-"+i,className:"single-result",title:products[i].name},img,el("label",{key:"gbt-sbo-product-search-result-item-label-"+i,className:"title-wrapper"},el("input",{key:"gbt-sbo-product-search-result-item-input-"+i,type:"checkbox",value:i,onChange:function(evt){evt.target;var qSS=toArray(attributes.selectedIDS);if(qSS.length<1&&0<attributes.querySearchSelected.length)for(var _i2=0;_i2<attributes.querySearchSelected.length;_i2++)qSS.push(attributes.querySearchSelected[_i2].id);var index=qSS.indexOf(products[evt.target.value].id);-1!=index&&qSS.splice(index,1),props.setAttributes({selectedIDS:qSS.join(",")});var query=getQuery("?include="+qSS.join(",")+"&orderby=include");0<qSS.length?(props.setAttributes({queryProducts:query}),apiFetch({path:query}).then(function(products){props.setAttributes({querySearchSelected:products})})):(props.setAttributes({queryProducts:""}),props.setAttributes({querySearchSelected:[]}))}}),products[i].name,el("span",{key:"gbt-sbo-product-search-result-item-dashicon-noalt"+i,className:"dashicons dashicons-no-alt"}))))}return productElements}())),el("button",{className:"render-results components-button is-button is-default is-primary is-large "+(!0===attributes.isLoading?"is-busy":""),disabled:0==attributes.queryProducts.length||attributes.queryProducts===attributes.queryProductsLast,onClick:function(e){var query=attributes.queryProducts;props.setAttributes({isLoading:!0}),props.setAttributes({querySearchString:""}),props.setAttributes({querySearchResults:[]}),props.setAttributes({queryProductsLast:query}),getProducts(query)}},!1===attributes.isLoading?i18n.__("Update"):i18n.__("Updating"))),el("div",{className:"products-main-inspector-wrapper"},el(SelectControl,{key:"lookbook-shop-by-outfit-image-position",options:[{value:"image-right",label:"Right"},{value:"image-left",label:"Left"}],label:i18n.__("Image Position"),value:attributes.image_position,onChange:function(newPosition){props.setAttributes({image_position:newPosition})}}))),el("div",{key:"gbt_18_editor_lookbook_sts_product_content",className:"gbt_18_editor_lookbook_sts_product_content "+attributes.image_position},el("div",{key:"gbt_18_editor_lookbook_sts_product_content_left",className:"gbt_18_editor_lookbook_sts_product_content_left"},attributes.result.length<1&&!1===attributes.doneFirstLoad&&getProducts(null),function(){var products=attributes.result,productElements=[],wrapper=[];if(0<products.length){for(var class_prefix="gbt_18_lookbook_sts_product",i=0;i<products.length;i++)productElements.push(el("li",{key:class_prefix+"_"+products[i].id,className:class_prefix},el("div",{key:class_prefix+"_content_wrapper_"+products[i].id+"-"+i,className:class_prefix+"_content_wrapper"},el("div",{key:class_prefix+"_thumbnail_"+products[i].id+"-"+i,className:class_prefix+"_thumbnail",style:{backgroundImage:"url("+products[i].images[0].src+")"}}),el("h4",{key:class_prefix+"_title_"+products[i].id+"-"+i,className:class_prefix+"_title"},products[i].name),el("span",{key:class_prefix+"_price_"+products[i].id+"-"+i,className:class_prefix+"_price",dangerouslySetInnerHTML:{__html:products[i].price_html}}),el("button",{key:class_prefix+"_button_"+products[i].id+"-"+i,className:class_prefix+"_button"},i18n.__("Add To Cart")))));wrapper.push(el("div",{key:"gbt_18_lookbook_sts_products_wrapper",className:"gbt_18_lookbook_sts_products_wrapper"},el("ul",{key:"gbt_18_lookbook_sts_products ",className:"gbt_18_lookbook_sts_products products-"+products.length},productElements)))}else{for(var _class_prefix="gbt_18_placeholder_lookbook_sts_product",_i=0;_i<2;_i++)productElements.push(el("li",{key:_class_prefix+"_"+_i,className:_class_prefix},el("div",{key:_class_prefix+"_content_wrapper_"+_i,className:_class_prefix+"_content_wrapper"},el("div",{key:_class_prefix+"_thumbnail_"+_i,className:_class_prefix+"_thumbnail"}),el("div",{key:_class_prefix+"_title_"+_i,className:_class_prefix+"_title"}),el("div",{key:_class_prefix+"_price_"+_i,className:_class_prefix+"_price"}),el("button",{key:_class_prefix+"_button_"+_i,className:_class_prefix+"_button"},i18n.__("Add To Cart")))));wrapper.push(el("div",{key:"gbt_18_placeholder_lookbook_sts_products_wrapper",className:"gbt_18_placeholder_lookbook_sts_products_wrapper"},el("ul",{key:"gbt_18_placeholder_lookbook_sts_products ",className:"gbt_18_placeholder_lookbook_sts_products "},productElements)))}return wrapper}()),el("div",{key:"gbt_18_editor_lookbook_sts_product_content_right",className:"gbt_18_editor_lookbook_sts_product_content_right"},el("div",{key:"gbt_18_editor_lookbook_sts_product_media_upload",className:"gbt_18_editor_lookbook_sts_product_media_upload"},el(MediaUpload,{key:"gbt_18_editor_product_media_upload",allowedTypes:["image"],formattingControls:["align"],buttonProps:{className:"components-button button button-large"},value:attributes.imgID,onSelect:function(img){props.setAttributes({imgID:img.id,imgURL:img.url,imgAlt:img.alt})},render:function(img){return[!attributes.imgID&&el(Button,{key:"gbt_18_lookbook_sts_product_add_image_button",className:"button add_image",onClick:img.open},i18n.__("Add Image")),!!attributes.imgID&&el(Button,{key:"gbt_18_lookbook_sts_product_remove_image_button",className:"button remove_image",onClick:function(){img.close,props.setAttributes({imgID:null,imgURL:null,imgAlt:null})}},i18n.__("Remove Image"))]}})),el("div",{key:"gbt_18_editor_lookbook_sts_product_content_image",className:"gbt_18_editor_lookbook_sts_product_content_image",style:{backgroundImage:"url("+attributes.imgURL+")"}})))]},save:function(props){return""}})}(window.wp.blocks,window.wp.components,window.wp.editor,window.wp.i18n);